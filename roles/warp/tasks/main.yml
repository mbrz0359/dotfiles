- name: Create Warp directory
  file:
    path: "{{ ansible_user_dir }}/Ansible/Warp"
    state: directory

- name: Download Warp
  ansible.builtin.get_url:
    url: https://app.warp.dev/download?package=appimage
    dest: "{{ ansible_user_dir }}/Ansible/Warp/Warp.AppImage"
    mode: "+x"
    owner: "{{ ansible_env['USER'] }}"
  run_once: true
  become: true

- name: Copy icon
  ansible.builtin.copy:
    src: "icon.png"
    dest: "{{ ansible_user_dir }}/Ansible/Warp/icon.png"
    owner: "{{ ansible_env['USER'] }}"
  become: true

- name: Add desktop file
  ansible.builtin.copy:
    src: "Warp.desktop"
    dest: "/usr/share/applications/Warp.desktop"
  become: true

- name: Set Warp directory in desktop file
  ansible.builtin.replace:
    path: "/usr/share/applications/Warp.desktop"
    regexp: 'WARP_DIRECTORY'
    replace: '{{ ansible_user_dir }}/Ansible/Warp'
  become: true
