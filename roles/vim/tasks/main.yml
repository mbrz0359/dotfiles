- name: Install nvim
  ansible.builtin.dnf:
    name:
      - neovim
  become: true
  when: ansible_facts['os_family'] == "RedHat"

- name: Copy .ideavimrc
  ansible.builtin.copy:
    src: ".ideavimrc"
    dest: "{{ ansible_user_dir }}/.ideavimrc"

- name: Copy init.vim
  ansible.builtin.copy:
    src: "init.vim"
    dest: "{{ ansible_user_dir }}/.config/nvim/"
  register: init_vim_result

- name: Create autoload directory
  file:
    path: "{{ ansible_user_dir }}/.local/share/nvim/site/autoload"
    state: directory

- name: Install vim-plug
  ansible.builtin.get_url:
    url: "https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim"
    dest: "{{ ansible_user_dir }}/.local/share/nvim/site/autoload/plug.vim"
    owner: "{{ ansible_env['USER'] }}"

- name: Update plugins
  ansible.builtin.command: nvim --headless +PlugUpdate +qall
  when: init_vim_result.changed